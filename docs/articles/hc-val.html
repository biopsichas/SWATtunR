<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validation • SWATtunR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Validation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SWATtunR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Introduction</h6></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/init.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Soft calibration</h6></li>
    <li><a class="dropdown-item" href="../articles/sc-phu.html">Crop PHUs</a></li>
    <li><a class="dropdown-item" href="../articles/sc-yield.html">Crop Yields</a></li>
    <li><a class="dropdown-item" href="../articles/sc-wy.html">Water Yield</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Hard calibration</h6></li>
    <li><a class="dropdown-item" href="../articles/hc-par.html">Parameter Definition</a></li>
    <li><a class="dropdown-item" href="../articles/hc-out.html">Output Definition</a></li>
    <li><a class="dropdown-item" href="../articles/hc-run.html">Performing Runs</a></li>
    <li><a class="dropdown-item" href="../articles/hc-analyze.html">Analyzing Results</a></li>
    <li><a class="dropdown-item" href="../articles/hc-val.html">Validation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quality Assurance</h6></li>
    <li><a class="dropdown-item" href="../articles/qa.html">Preparation</a></li>
    <li><a class="dropdown-item" href="../articles/qa-st1.html">Step 1: Input</a></li>
    <li><a class="dropdown-item" href="../articles/qa-st2.html">Step 2: Management</a></li>
    <li><a class="dropdown-item" href="../articles/qa-st3.html">Step 3: Growth</a></li>
    <li><a class="dropdown-item" href="../articles/qa-st4.html">Step 4: Stress</a></li>
    <li><a class="dropdown-item" href="../articles/qa-st5.html">Step 5: Other</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biopsichas/SWATtunR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Validation</h1>
            <h3 data-toc-skip class="subtitle">Validation of model
performance using selected parameter sets</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biopsichas/SWATtunR/blob/HEAD/vignettes/hc-val.Rmd" class="external-link"><code>vignettes/hc-val.Rmd</code></a></small>
      <div class="d-none name"><code>hc-val.Rmd</code></div>
    </div>

    
    
<p>This page corresponds to the <strong>05_validate.R</strong> script in
the hard calibration workflow. It provides a simple example of model
validation. The validation workflow is similar to the calibration
workflow, with the main difference being that only selected parameter
sets are used for the model runs.</p>
<div class="section level2">
<h2 id="load-packages-and-settings">1. Load packages and settings<a class="anchor" aria-label="anchor" href="#load-packages-and-settings"></a>
</h2>
<p>In the first step, the script loads the required packages, then it
defines the model path and validation period, sets the simulation start
and end dates, configures parallel processing, and specifies file names
and paths for saving results. It selects the parameter sets for the
validation runs.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required R packages (if not yet done)-------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chrisschuerz/SWATrunR" class="external-link">SWATrunR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biopsichas/SWATtunR" class="external-link">SWATtunR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hzambran/hydroGOF" class="external-link">hydroGOF</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path to the SWAT+ project folder.</span></span>
<span><span class="va">model_path</span> <span class="op">&lt;-</span> <span class="st">''</span></span>
<span></span>
<span><span class="co">## Define the period for which validate the calibrated model</span></span>
<span><span class="va">period_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'yyyy-mm-dd'</span>, <span class="st">'yyyy-mm-dd'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start date of the simulation for the validation period.</span></span>
<span><span class="co"># This should be at least 2 years before 'start_date_print' and the start of the</span></span>
<span><span class="co"># validation period to ensure the model reaches a steady state.</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">'yyyy-mm-dd'</span></span>
<span><span class="co"># End date of simulation of validation period</span></span>
<span><span class="va">end_date</span> <span class="op">&lt;-</span> <span class="va">period_valid</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co"># Start date for printing of validation simulation outputs</span></span>
<span><span class="va">start_date_print</span> <span class="op">&lt;-</span> <span class="va">period_valid</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Number of cores used for parallel simulation runs</span></span>
<span><span class="va">n_cores</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="co"># Name of the folder where simulation results will be saved incrementally.</span></span>
<span><span class="co"># To continue writing to existing saved runs, replace by the name of the</span></span>
<span><span class="co"># existing save_file.</span></span>
<span><span class="va">save_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">'%Y%m%d%H%M'</span><span class="op">)</span>, <span class="st">'_sim_val'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Path where the simulation results are saved.</span></span>
<span><span class="co"># Default the simulations are saved in the calibration project</span></span>
<span><span class="co"># in the sub-folder /simulation</span></span>
<span><span class="va">save_path</span> <span class="op">&lt;-</span> <span class="st">'./simulation'</span></span>
<span></span>
<span><span class="co"># E.g. path to discharge observations</span></span>
<span><span class="va">flow_path</span> <span class="op">&lt;-</span> <span class="st">'./observation/.csv'</span></span>
<span></span>
<span><span class="co">## The main step in valitadion is to run only selected parameter sets</span></span>
<span><span class="va">parameter_set_valid</span> <span class="op">&lt;-</span> <span class="va">parameter_set</span><span class="op">[</span><span class="va">run_ids</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="perform-simulation-runs-and-load-results">2. Perform simulation runs and load results<a class="anchor" aria-label="anchor" href="#perform-simulation-runs-and-load-results"></a>
</h2>
<p>In this step, the script performs the simulation runs using the
validated parameter and loads the simulation results, observation data
for further analysis.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform simulation runs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/run_swatplus.html" class="external-link">run_swatplus</a></span><span class="op">(</span>project_path     <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>             output           <span class="op">=</span> <span class="va">outputs</span>,</span>
<span>             parameter        <span class="op">=</span> <span class="va">parameter_set_valid</span>,</span>
<span>             start_date       <span class="op">=</span> <span class="va">start_date</span>,</span>
<span>             end_date         <span class="op">=</span> <span class="va">end_date</span>,</span>
<span>             start_date_print <span class="op">=</span> <span class="va">start_date_print</span>,</span>
<span>             n_thread         <span class="op">=</span> <span class="va">n_cores</span>,</span>
<span>             save_path        <span class="op">=</span> <span class="va">save_path</span>,</span>
<span>             save_file        <span class="op">=</span> <span class="va">save_file_name</span>,</span>
<span>             return_output    <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             split_units      <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># better set TRUE for large number of units</span></span>
<span>             time_out         <span class="op">=</span> <span class="fl">3600</span> <span class="co"># seconds, change if run-time differs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameter definition ----------------------------------------------------</span></span>
<span><span class="co"># Paths to simulation and observation data</span></span>
<span><span class="co"># E.g. load the simulations with the last time stamp, if default</span></span>
<span><span class="co"># save_file names in simulation runs is used.</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">'./simulation/'</span>, pattern <span class="op">=</span> <span class="st">'[0-9]{12}_sim_val'</span><span class="op">)</span></span>
<span><span class="va">sim_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'./simulation/'</span>, <span class="va">sims</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sims</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load and prepare simulation results -------------------------------------</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/load_swat_run.html" class="external-link">load_swat_run</a></span><span class="op">(</span><span class="va">sim_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># E.g. discharge observations</span></span>
<span><span class="va">flow_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">flow_path</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/filter_period.html">filter_period</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">period_valid</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flow_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter_period.html">filter_period</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">simulation</span><span class="op">$</span><span class="va">flo_day</span>, <span class="va">period_valid</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyze-results">3. Analyze results<a class="anchor" aria-label="anchor" href="#analyze-results"></a>
</h2>
<p>In this step, the script evaluates the model performance. It first
calculates the flow duration curves (FDCs) for simulated and observed
discharges. Then, it computes goodness-of-fit (GOF) metrics such as NSE,
KGE, PBIAS, and MAE for discharge, and evaluates RSR values across
different FDC segments. The results are combined into a single table,
from which selected GOF values are extracted. Finally, it summarizes the
mean performance metrics across all runs, with options for further
analysis or plotting provided in a separate script.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># E.g. if FDC segments should be evaluated, calculate the</span></span>
<span><span class="co"># FDC for the simulated discharges</span></span>
<span><span class="va">flow_fdc_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_fdc.html">calc_fdc</a></span><span class="op">(</span><span class="va">flow_sim</span><span class="op">)</span></span>
<span><span class="co"># E.g. if FDC segments should be evaluated, calculate the</span></span>
<span><span class="co"># FDC for the simulated discharges</span></span>
<span><span class="va">flow_fdc_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_fdc.html">calc_fdc</a></span><span class="op">(</span><span class="va">flow_obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate goodness-of-fit values ----------------------------------------</span></span>
<span><span class="co"># E.g. to calculate typical indices such as NSE, KGE, pbias, etc. for discharge</span></span>
<span><span class="va">gof_flow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_gof.html">calc_gof</a></span><span class="op">(</span>sim <span class="op">=</span> <span class="va">flow_sim</span>, obs <span class="op">=</span> <span class="va">flow_obs</span>,</span>
<span>                     funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nse_q <span class="op">=</span> <span class="va">NSE</span>, kge_q <span class="op">=</span> <span class="va">KGE</span>, pb_q <span class="op">=</span> <span class="va">pbias</span>,</span>
<span>                                 mae_q <span class="op">=</span> <span class="va">mae</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate RSR for different discharge FDC sections (as proposed in</span></span>
<span><span class="co"># Pfannerstill et al., 2014 (https://doi.org/10.1016/j.jhydrol.2013.12.044))</span></span>
<span><span class="va">gof_fdc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_fdc_rsr.html">calc_fdc_rsr</a></span><span class="op">(</span>fdc_sim <span class="op">=</span> <span class="va">flow_fdc_sim</span>, fdc_obs <span class="op">=</span> <span class="va">flow_fdc_obs</span>,</span>
<span>                        quantile_splits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">70</span>, <span class="fl">95</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># E.g. if all calculated GOF tables should be joined to one table</span></span>
<span><span class="va">gof_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">gof_flow</span>, <span class="va">gof_fdc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">left_join</span>, by <span class="op">=</span> <span class="st">'run'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select the GOF values of interest</span></span>
<span><span class="va">gof_sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">gof_all</span>, <span class="va">run</span>, <span class="va">nse_q</span>, <span class="va">pb_q</span>, <span class="va">p_0_5</span>, <span class="va">p_20_70</span>, <span class="va">p_70_95</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print the mean GOF values for all runs</span></span>
<span><span class="va">gof_sel</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gof_sel</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gof_sel</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"run"</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarise_all</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For plotting options or extension to different variables, etc., see the the</span></span>
<span><span class="co"># 04_analyze_results.R script.</span></span></code></pre></div>
<p>For plotting options, please refer to this <a href="../articles/hc-analyze.html">page</a> for guidance on visualizing
the results, as well as the <code>04_analyze_results.R</code>
script.</p>
<p>If you are satisfied with the validation results, it is advisable to
check for any underlying issues in the model setup before proceeding to
scenario modeling. This can be done using the SWAT+ model setup
verification workflow described <a href="../articles/qa.html">here</a>,
which helps identify potential issues and can save considerable time in
later stages of model use. The quality assurance step is particularly
important if the model will be applied to scenario analysis for
decision-making.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Svajunas Plunge, Christoph Schuerz, Michael Strauch, Mikołaj Piniewski.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
