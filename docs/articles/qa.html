<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SWATtunR">
<title>Preparation • SWATtunR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparation">
<meta property="og:description" content="SWATtunR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SWATtunR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/intro.html">Overview</a>
    <a class="dropdown-item" href="../articles/init.html">Getting Started</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Soft calibration</h6>
    <a class="dropdown-item" href="../articles/sc-crops.html">Crop Yields</a>
    <a class="dropdown-item" href="../articles/sc-wy.html">Water Yield</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Hard calibration</h6>
    <a class="dropdown-item" href="../articles/hc-par.html">Parameter Definition</a>
    <a class="dropdown-item" href="../articles/hc-out.html">Output Definition</a>
    <a class="dropdown-item" href="../articles/hc-run.html">Performing Runs</a>
    <a class="dropdown-item" href="../articles/hc-analyze.html">Analyzing Results</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Quality Assurance</h6>
    <a class="dropdown-item" href="../articles/qa.html">Preparation</a>
    <a class="dropdown-item" href="../articles/qa-st1.html">Step 1: Input</a>
    <a class="dropdown-item" href="../articles/qa-st2.html">Step 2: Management</a>
    <a class="dropdown-item" href="../articles/qa-st3.html">Step 3: Growth</a>
    <a class="dropdown-item" href="../articles/qa-st4.html">Step 4: Stress</a>
    <a class="dropdown-item" href="../articles/qa-st5.html">Step 5: Other</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/biopsichas/SWATtunR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Preparation</h1>
            <h3 data-toc-skip class="subtitle">Workflow for SWAT+ model
setup verification</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biopsichas/SWATtunR/blob/HEAD/vignettes/qa.Rmd" class="external-link"><code>vignettes/qa.Rmd</code></a></small>
      <div class="d-none name"><code>qa.Rmd</code></div>
    </div>

    
    
<p>This workflow provides guidance for the model setup verification of
SWAT+ model setup. It is important step in quality assurance of models.
This workflow should be used before and after the model calibration and
validation. Before, as it is important to verify the model setup before
calibration and validation to avoid trying to over compensate for model
mistakes with model parametrization. After, as it is important to check
that model calibration did not introduce any errors in the model setup
or created problems with representation of the processes in the model.
This workflow essentially summarizes all steps, which are described in
the <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">SWAT+ modeling
protocol</a> sections 6.2.2. and 6.2.3 <span class="citation">Christoph
et al. (2022)</span>.</p>
<p>This workflow is based model on model setup verification workflow
presented in the article of <span class="citation">Plunge et al.
(2024)</span>. The main 5 steps of the workflow are as follows:</p>
<ol style="list-style-type: decimal">
<li>Analysis of the simulated climate variables to verify if the weather
inputs were correctly interpreted.</li>
<li>Analysis of the triggered management operations to verify if the
management operation inputs were correct.</li>
<li>Unconstrained plant growth analysis to verify if the used plants and
growing periods lead to plausible potential plant growth.</li>
<li>Analysis of plant growth considering plant stress to identify
potential limiting factors such as fertilizer or irrigation inputs.</li>
<li>Verification of point source inputs to ensure that tile flow and
point sources were plausibly simulated.</li>
</ol>
<div class="section level2">
<h2 id="qa_step1">1. Loading required packages<a class="anchor" aria-label="anchor" href="#qa_step1"></a>
</h2>
<p><code>SWATdoctR</code> package is the basis of this workflow. So it
should be installed and loaded, if not done. The installation of an
<code>R</code> package from a platform such as GitHub or GitLab can be
done with the package <code>remotes</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If the package 'remotes' is not installed </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'remotes'</span><span class="op">)</span></span>
<span><span class="co"># If the package 'SWATdoctR' is not installed </span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_git.html" class="external-link">install_git</a></span><span class="op">(</span><span class="st">'https://git.ufz.de/schuerz/swatdoctr'</span><span class="op">)</span></span></code></pre></div>
<p>Load of <code>SWATdoctR</code> with the following line. This is the
only package needed for the workflow.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SWATdoctR</span><span class="op">)</span>  </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="qa_step2">2. Define the model path<a class="anchor" aria-label="anchor" href="#qa_step2"></a>
</h2>
<p>For model setup verification the path to it have to be defined. If it
is setup after calibration and validation, make sure it contains
<em>‘calibration.cal’</em> file. It can be prepared with this <a href="#val_step4">step</a></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to the SWAT+ project</span></span>
<span><span class="va">model_path</span> <span class="op">&lt;-</span> <span class="st">'Define:/your/model/txtinout/path'</span></span>
<span></span>
<span><span class="co"># Path to folder where project is located (for later file writing)</span></span>
<span><span class="va">parent_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">model_path</span><span class="op">)</span></span>
<span><span class="co"># Name of the SWAT+ project folder (for later file reading/writing)</span></span>
<span><span class="va">save_name</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">'/$'</span>, <span class="st">''</span>, <span class="va">model_path</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="qa_step3">3. (Optional) Harvest and kill operation seperation<a class="anchor" aria-label="anchor" href="#qa_step3"></a>
</h2>
<p>Plotting of variables at the harvest and kill of a crop requires that
the management operations ‘harvest’ and ‘kill’ are set separately in the
management schedules and not as a combined ‘harvest_kill’ operation. If
case your model setup have combined operation the following function
fixes the issue.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SWATdoctR/man/add_kill_op.html" class="external-link">add_kill_op</a></span><span class="op">(</span><span class="va">model_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="qa_step4">4. Running the SWAT+ model (all plant stress factors
deactivated)<a class="anchor" aria-label="anchor" href="#qa_step4"></a>
</h2>
<p>With <code>run_swat_verification</code> SWAT+ simulations are
performed for the model setup in the <code>model_path</code>, which will
be used in the verification steps. The simulations for the analysis
steps 1. to 3. above are preformed without plant stress activated. The
simulation results are saved in the same folder where the SWAT+ project
is located. The verification is an iterative step, where the simulation
has to be repeated after identified issues in a model setup are fixed
and verification steps are repeated.</p>
<p>Every time the simulation is repeated it is saved with a new file
name (to have all previous steps documented), with a name that follows
the syntax <em>‘&lt;project_name&gt;_nostr_&lt;version&gt;.rds’</em>. It
is also important to note that the outputs from the
run_swat_verification function, depending on the setup, could be
multiple gigabytes in size, which might cause <code>R</code> to break
and restart. Therefore, archiving results is crucial. Automatically the
new version is always increased by 1 with respect to the largest version
number found in the folder. You can delete previous versions manually
from the folder.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Running SWAT+ model setup and saving outputs required for the workflow</span></span>
<span><span class="va">sim_nostress</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATdoctR/man/run_swat_verification.html" class="external-link">run_swat_verification</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>                                      outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'wb'</span>, <span class="st">'mgt'</span>, <span class="st">'plt'</span><span class="op">)</span>,</span>
<span>                                      years_skip <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                      nostress <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Saving results into the file</span></span>
<span><span class="va">file_version</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATdoctR/man/get_file_version.html" class="external-link">get_file_version</a></span><span class="op">(</span><span class="va">parent_dir</span>, <span class="va">save_name</span>, <span class="st">'_nostr_'</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">sim_nostress</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">parent_dir</span>,<span class="st">'/'</span>, <span class="va">save_name</span>, <span class="st">'_nostr_'</span>, </span>
<span>                                    <span class="va">file_version</span>,<span class="st">'.rds'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Following lines could be used to load saved results from the
file.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">file_version</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATdoctR/man/get_file_version.html" class="external-link">get_file_version</a></span><span class="op">(</span><span class="va">parent_dir</span>, <span class="va">save_name</span>, <span class="st">'_nostr_'</span><span class="op">)</span></span>
<span><span class="va">sim_nostress</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">parent_dir</span>,<span class="st">'/'</span>, </span>
<span>                                      <span class="va">save_name</span>, <span class="st">'_nostr_'</span>, </span>
<span>                                      <span class="va">file_version</span>,<span class="st">'.rds'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The following analyses in <a href="../articles/qa-st1.html">step
1</a>, <a href="../articles/qa-st2.html">step 2</a> and <a href="../articles/qa-st4.html">step 3</a> use the file version
file_version of <code>sim_nostress</code>.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-optain2022" class="csl-entry">
Christoph, Schürz, Čerkasova Natalja, Farkas Csilla, Nemes Attila,
Plunge Svajunas, Strauch Michael, Szabó Brigitta, and Piniewski Mikołaj.
2022. <span>“<span class="nocase">SWAT+ modeling protocol for the
assessment of water and nutrient retention measures in small
agricultural catchments</span>.”</span> Zenodo. <a href="https://doi.org/10.5281/zenodo.7463395" class="external-link">https://doi.org/10.5281/zenodo.7463395</a>.
</div>
<div id="ref-plunge2024a" class="csl-entry">
Plunge, Svajunas, Christoph Schürz, Natalja Čerkasova, Michael Strauch,
and Mikołaj Piniewski. 2024. <span>“<span class="nocase">SWAT+ model
setup verification tool: SWATdoctR</span>.”</span> <em>Environmental
Modelling &amp; Software</em> 171: 105878. <a href="https://doi.org/10.1016/j.envsoft.2023.105878" class="external-link">https://doi.org/10.1016/j.envsoft.2023.105878</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Svajunas Plunge, Christoph Schuerz, Michael Strauch, Mikołaj Piniewski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
