<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SWATtunR">
<title>Water Yield • SWATtunR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Water Yield">
<meta property="og:description" content="SWATtunR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SWATtunR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/intro.html">Overview</a>
    <a class="dropdown-item" href="../articles/init.html">Getting Started</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Soft calibration</h6>
    <a class="dropdown-item" href="../articles/sc-crops.html">Crop Yields</a>
    <a class="dropdown-item" href="../articles/sc-wy.html">Water Yield</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Hard calibration</h6>
    <a class="dropdown-item" href="../articles/hc-par.html">Parameter Definition</a>
    <a class="dropdown-item" href="../articles/hc-out.html">Output Definition</a>
    <a class="dropdown-item" href="../articles/hc-run.html">Performing Runs</a>
    <a class="dropdown-item" href="../articles/hc-analyze.html">Analyzing Results</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Quality Assurance</h6>
    <a class="dropdown-item" href="../articles/qa.html">Preparation</a>
    <a class="dropdown-item" href="../articles/qa-st1.html">Step 1: Input</a>
    <a class="dropdown-item" href="../articles/qa-st2.html">Step 2: Management</a>
    <a class="dropdown-item" href="../articles/qa-st3.html">Step 3: Growth</a>
    <a class="dropdown-item" href="../articles/qa-st4.html">Step 4: Stress</a>
    <a class="dropdown-item" href="../articles/qa-st5.html">Step 5: Other</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/biopsichas/SWATtunR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Water Yield</h1>
            <h3 data-toc-skip class="subtitle">Soft calibration workflow
for water yield ratio in SWAT+ models</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biopsichas/SWATtunR/blob/HEAD/vignettes/sc-wy.Rmd" class="external-link"><code>vignettes/sc-wy.Rmd</code></a></small>
      <div class="d-none name"><code>sc-wy.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <strong>SWATtunR</strong> package supports a flexible and
systematic approach to soft calibration of hydrological parameters in
SWAT+ for water yield calibration. This template script—intended to be
adapted for each specific SWAT project—guides users through the
calibration.</p>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>The calibration process is structured into two main alternatives:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Alternative A</strong>: Calibrate the <code>esco</code>
parameter to achieve a target water yield ratio for the modeled
catchment. <code>esco</code> (soil evaporation compensation factor)
allows users to adjust the depth distribution used to meet soil
evaporative demand, accounting for effects such as capillary action,
crusting, and cracks. The default value is 0.5. This parameter is
essential for accurately simulating the water balance in SWAT+ models,
especially in regions where soil evaporation significantly influences
the hydrological cycle.</p></li>
<li><p><strong>Alternative B</strong>: Jointly calibrate the
<code>esco</code> and <code>epco</code> parameters. <code>epco</code>
(plant uptake compensation factor) controls the extent to which deeper
soil layers can compensate for water shortages in upper layers. When
<code>epco</code> is close to 1.0, plants can draw more water from
deeper layers; when near 0.0, uptake is restricted to the original root
depth distribution, allowing minimal compensation.</p></li>
</ol>
<p>If this alternative is chosen, <code>epco</code> should be kept as
close as possible to its default value of 0, as significant changes can
strongly affect crop yield simulations. If such changes occur, the crop
yield soft calibration <a href="../articles/sc-crops.html">step</a>
should be revisited.</p>
<p>The following workflow script is generated by the soft calibration
function <code><a href="../reference/initialize_softcal.html">initialize_softcal()</a></code>. It is located in
<code>workflow/02_wateryield_calibration.R</code>. This script serves as
a customizable template to guide users through the water yield soft
calibration process effectively.</p>
<p>An overview of all workflow steps is presented in the figure below.
This page provides a detailed description of each step, including the
necessary code snippets and explanations.</p>
<p><img src="figs/fig10.png" width="95%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="load-packages-settings-wyr-target">1. Load packages, settings &amp; WYR target<a class="anchor" aria-label="anchor" href="#load-packages-settings-wyr-target"></a>
</h2>
<p>The <strong>SWATtunR</strong> package is essential for soft
calibration, as it provides the necessary functions for the calibration
process. Additional packages are required for data manipulation,
visualization, SWAT+ model runs, etc.</p>
<p>In this example, we present the <strong>Alternative B</strong>
workflow for water yield ratio soft calibration, as it represents the
slightly more complex option. Users can switch to <strong>Alternative
A</strong> by setting the <code>alternative</code> variable to
<code>'A'</code>. The model path should be updated to point to the
user’s specific SWAT+ project folder.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required R packages ------------------------------------------------</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/biopsichas/SWATtunR" class="external-link">SWATtunR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/chrisschuerz/SWATrunR" class="external-link">SWATrunR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameter definition ----------------------------------------------------</span></span>
<span><span class="co"># Decide for calibration alternative 'A' (only esco) or 'B' (esco and epco).</span></span>
<span><span class="va">alternative</span> <span class="op">&lt;-</span> <span class="st">'B'</span></span>
<span></span>
<span><span class="co"># Path to the SWAT+ project folder.</span></span>
<span><span class="va">model_path</span> <span class="op">&lt;-</span> <span class="st">'test/swatplus_rev60_demo'</span></span>
<span></span>
<span><span class="co"># Set the number of cores for parallel model execution</span></span>
<span><span class="va">n_cores</span> <span class="op">&lt;-</span> <span class="cn">Inf</span> <span class="co"># Inf uses all cores. Set lower value if preferred.</span></span>
<span></span>
<span><span class="co"># Set the number of steps in which the parameters esco/epco should be sampled</span></span>
<span><span class="co"># A low number of e.g. 5 to 10 is absolutely sufficient.</span></span>
<span><span class="va">n_step</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span></span>
<span><span class="co"># Set the target water yield ratio for the catchment (calculated from precipitation and flow data)</span></span>
<span><span class="va">wyr_target</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span></span>
<span><span class="co"># Load and prepare data ---------------------------------------------------</span></span>
<span><span class="co"># Load the yield observations</span></span>
<span><span class="va">yield_obs_path</span> <span class="op">&lt;-</span> <span class="st">'./observation/crop_yields.csv'</span></span>
<span><span class="va">yield_obs</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">yield_obs_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the crops which should be used in the calibration.</span></span>
<span><span class="co"># Default is all crops which are defined in yield_obs.</span></span>
<span><span class="co"># Please define manually if only selected crops should be considered.</span></span>
<span><span class="va">crop_names</span> <span class="op">&lt;-</span> <span class="va">yield_obs</span><span class="op">$</span><span class="va">plant_name</span></span>
<span></span>
<span><span class="co"># Optional reset of hydrology.hyd -----------------------------------------</span></span>
<span><span class="co"># In the case the water yield ratio calibration workflow should be redone after</span></span>
<span><span class="co"># the last step of this script was already executed and the hydrology.hyd was</span></span>
<span><span class="co"># overwritten the hydrology.hyd should be reset to its initial condition. To</span></span>
<span><span class="co"># perform the reset set reset &lt;- TRUE</span></span>
<span><span class="va">reset</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">reset</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">'./backup/hydrology.hyd'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="st">'./backup/hydrology.hyd'</span>,</span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">model_path</span>, <span class="st">'/hydrology.hyd'</span><span class="op">)</span>,</span>
<span>            overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generate-parameter-set-for-escoepco">2. Generate parameter set for esco/epco<a class="anchor" aria-label="anchor" href="#generate-parameter-set-for-escoepco"></a>
</h2>
<p>In this step, we generate a parameter set for the <code>esco</code>
and <code>epco</code> parameters. If <code>n_step</code> is set to 5,
then 5 × 5 = 25 parameter combinations will be generated. The parameters
are sampled at equal intervals between 0.05 and 0.95. Other intervals
can be used as well.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Alternative A: Calibrate esco -------------------------------------------</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">alternative</span> <span class="op">==</span> <span class="st">'A'</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Sample the paramter esco with the defined number of steps.</span></span>
<span>  <span class="va">par_esco_epco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'esco.hru | change = absval'</span> <span class="op">=</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>, length.out <span class="op">=</span> <span class="va">n_step</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Alternative B: Calibrate esco and epco ----------------------------------</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">alternative</span> <span class="op">==</span> <span class="st">'B'</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Define the esco and epco parameter ranges.</span></span>
<span>  <span class="va">par_bnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span>, length.out <span class="op">=</span> <span class="va">n_step</span><span class="op">)</span>,</span>
<span>                    <span class="st">'epco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span>, length.out <span class="op">=</span> <span class="va">n_step</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Sample the esco epco combinations with LHS sampling.</span></span>
<span>  <span class="va">par_esco_epco</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">par_bnd</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-model-for-parameter-set">3. Run model for parameter set<a class="anchor" aria-label="anchor" href="#run-model-for-parameter-set"></a>
</h2>
<p>In this step <code>run_swatplus</code> function from
<strong>SWATrunR</strong> package executes the model simulations for
each combination of prepared parameters. All simulation results are
saved in the <code>./simulation</code> folder. Each set of results is
time-stamped, so if the process is repeated, the most recent simulations
are always used in the analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the SWAT+ model for each parameter combination</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/run_swatplus.html" class="external-link">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>             output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precip  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'precip'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           surq_cha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'surq_cha'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           surq_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'surq_res'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           latq_cha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'latq_cha'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           latq_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'latq_res'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           qtile <span class="op">=</span>    <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'qtile'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           flo <span class="op">=</span>      <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_aqu_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'flo'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>             <span class="op">)</span>,</span>
<span>             parameter        <span class="op">=</span> <span class="va">par_esco_epco</span>,</span>
<span>             start_date       <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Change if necessary.</span></span>
<span>             end_date         <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Change if necessary.</span></span>
<span>             add_date         <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             years_skip       <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Change if necessary.</span></span>
<span>             n_thread         <span class="op">=</span> <span class="va">n_cores</span>,</span>
<span>             save_path        <span class="op">=</span> <span class="st">'./simulation'</span>,</span>
<span>             save_file        <span class="op">=</span> <span class="fu"><a href="../reference/add_timestamp.html">add_timestamp</a></span><span class="op">(</span><span class="st">'sim_wbal'</span><span class="op">)</span>,</span>
<span>             return_output    <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             time_out         <span class="op">=</span> <span class="fl">3600</span> <span class="co"># seconds, change if run-time differs</span></span>
<span>             <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-and-select-escoepco-parameters">4. Plot and select esco/epco parameters<a class="anchor" aria-label="anchor" href="#plot-and-select-escoepco-parameters"></a>
</h2>
<p>The <code>load_swat_run</code> function from the
<strong>SWATrunR</strong> package is used to load the most recent
simulation results from the <code>simulation</code> folder. The
<code><a href="../reference/plot_esco_epco.html">plot_esco_epco()</a></code> function is then used to visualize the
results.</p>
<p>Based on the simulated water balance components for the different
<code>esco</code> and <code>epco</code> values, a simulated water yield
ratio is calculated and plotted against the parameter values. The plot
also includes the target water yield ratio to help identify a suitable
range or value for <code>esco</code> and <code>epco</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the most recent simulation results of the water balance components.</span></span>
<span><span class="va">wbal_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">'./simulation/'</span>, pattern <span class="op">=</span> <span class="st">'[0-9]{12}_sim_wbal'</span><span class="op">)</span></span>
<span><span class="va">wbal_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'./simulation/'</span>, <span class="va">wbal_sims</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">wbal_sims</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">wbal_sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/load_swat_run.html" class="external-link">load_swat_run</a></span><span class="op">(</span><span class="va">wbal_path</span>, add_date <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the water balance components and the water yield ratio</span></span>
<span><span class="fu"><a href="../reference/plot_esco_epco.html">plot_esco_epco</a></span><span class="op">(</span><span class="va">wbal_sim</span>, <span class="fl">0.28</span>, rel_wyr_limit <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs/fig11.png" width="95%" style="display: block; margin: auto;"></p>
<p>The <code>esco</code>/<code>epco</code> plot displays recommended
parameter values that meet the target water yield ratio. There are two
options for defining <code>esco</code> and <code>epco</code> for further
use in the model:</p>
<p><strong>Option 1: Set fixed values in the <code>hydrology.hyd</code>
file</strong> If specific values for <code>esco</code> and/or
<code>epco</code> are selected, they can be written directly into the
<code>hydrology.hyd</code> file, replacing the initial values. These
fixed values can either serve as a starting point for further
calibration or be maintained as constant values during later calibration
steps.</p>
<p><strong>Option 2: Use parameter ranges for further
calibration</strong> Alternatively, parameter ranges can be selected
based on the plot and used in additional simulations with
<strong>SWATrunR</strong>, for example, during more detailed (hard)
calibration.</p>
<p>Before choosing one of these options, it is recommended to run an
additional simulation using a selected
<code>esco</code>/<code>epco</code> parameter set. This helps evaluate
the simulated water yield ratio and crop yields, especially since
parameters like <code>epco</code> can influence simulated plant
growth.</p>
<p>In this example we will use the first option and set fixed values for
<code>esco</code> and <code>epco</code> in the
<code>hydrology.hyd</code> file. Following values are selected based on
the plot above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set fixed values for esco and epco in the hydrology.hyd file. Alternative 'B' is used here.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">alternative</span> <span class="op">==</span> <span class="st">'A'</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">par_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="co"># Adjust accordingly</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">alternative</span> <span class="op">==</span> <span class="st">'B'</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">par_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fl">0.02</span>, <span class="co"># Adjust accordingly</span></span>
<span>                      <span class="st">'epco.hru | change = absval'</span> <span class="op">=</span> <span class="fl">0.12</span><span class="op">)</span> <span class="co"># Adjust accordingly</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-model-for-user-escoepco-values">5. Run model for user esco/epco values<a class="anchor" aria-label="anchor" href="#run-model-for-user-escoepco-values"></a>
</h2>
<p>In this step, the model is run again using the selected
<code>esco</code> and <code>epco</code> values. The results are saved in
a new folder.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rerun model for crop yields results</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/run_swatplus.html" class="external-link">run_swatplus</a></span><span class="op">(</span>project_path <span class="op">=</span> <span class="va">model_path</span>,</span>
<span>             output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>precip  <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'precip'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           surq_cha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'surq_cha'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           surq_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'surq_res'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           latq_cha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'latq_cha'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           latq_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'latq_res'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           qtile    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_wb_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'qtile'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           flo      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'basin_aqu_aa'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'flo'</span>,</span>
<span>                                                    unit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                           yld      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'mgtout'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'yld'</span>,</span>
<span>                                                    label <span class="op">=</span> <span class="va">crop_names</span><span class="op">)</span>,</span>
<span>                           bms      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'mgtout'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'bioms'</span>,</span>
<span>                                                    label <span class="op">=</span> <span class="va">crop_names</span><span class="op">)</span>,</span>
<span>                           phu      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/define_output.html" class="external-link">define_output</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'mgtout'</span>,</span>
<span>                                                    variable <span class="op">=</span> <span class="st">'phu'</span>,</span>
<span>                                                    label <span class="op">=</span> <span class="va">crop_names</span><span class="op">)</span></span>
<span>             <span class="op">)</span>,</span>
<span>             parameter        <span class="op">=</span> <span class="va">par_check</span>,</span>
<span>             start_date       <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Change if necessary.</span></span>
<span>             end_date         <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Change if necessary.</span></span>
<span>             <span class="co"># add_date         = FALSE,</span></span>
<span>             years_skip       <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Change if necessary.</span></span>
<span>             n_thread         <span class="op">=</span> <span class="va">n_cores</span>,</span>
<span>             save_path        <span class="op">=</span> <span class="st">'./simulation'</span>,</span>
<span>             save_file        <span class="op">=</span> <span class="fu"><a href="../reference/add_timestamp.html">add_timestamp</a></span><span class="op">(</span><span class="st">'sim_check02'</span><span class="op">)</span>,</span>
<span>             return_output    <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             time_out         <span class="op">=</span> <span class="fl">3600</span> <span class="co"># seconds, change if run-time differs</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-to-check-final-results">6. Plot to check final results<a class="anchor" aria-label="anchor" href="#plot-to-check-final-results"></a>
</h2>
<p>Before finalizing the model, it is important to recheck the crop
simulation results with the selected <code>esco</code> and
<code>epco</code> values. The <code><a href="../reference/plot_phu_yld_bms.html">plot_phu_yld_bms()</a></code> function
can be used again to visualize crop yields and biomass, as well as the
Potential Heat Units at the harvest for each crop.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the most recent simulation results.</span></span>
<span><span class="va">check_sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">'./simulation/'</span>, pattern <span class="op">=</span> <span class="st">'[0-9]{12}_sim_check02'</span><span class="op">)</span></span>
<span><span class="va">check_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'./simulation/'</span>, <span class="va">check_sims</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">check_sims</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">check_sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATrunR/man/load_swat_run.html" class="external-link">load_swat_run</a></span><span class="op">(</span><span class="va">check_path</span>, add_date <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot PHU, crop yields and biomass for final simulation run.</span></span>
<span><span class="fu"><a href="../reference/plot_phu_yld_bms.html">plot_phu_yld_bms</a></span><span class="op">(</span><span class="va">check_sim</span>, <span class="va">yield_obs</span>, <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="figs/fig10.png" width="95%" style="display: block; margin: auto;"></p>
<p>If everything looks good, the final water yield ratio from the model
results should also be checked using the <code><a href="../reference/calc_wyr.html">calc_wyr()</a></code>
function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check the simulated water yield ratio with reference to the target wyr.</span></span>
<span><span class="fu"><a href="../reference/calc_wyr.html">calc_wyr</a></span><span class="op">(</span><span class="va">check_sim</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="update-hydrology-hyd-file-or-save-in-r">7. Update ‘hydrology.hyd’ file or save in R<a class="anchor" aria-label="anchor" href="#update-hydrology-hyd-file-or-save-in-r"></a>
</h2>
<p>The last step is to save the selected <code>esco</code> and
<code>epco</code> values either in the <code>hydrology.hyd</code> file
or save them in R for future use. This ensures that the model can be run
with these parameters in subsequent simulations.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Option 1: Re-writing SWAT+ parameter file hydrology.hyd</span></span>
<span><span class="co"># If SWATreadR is not installed please install from:</span></span>
<span><span class="co"># devtools::install_github('chrisschuerz/SWATreadR')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SWATreadR</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">'./backup/hydrology.hyd'</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">model_path</span>, <span class="st">'/hydrology.hyd'</span><span class="op">)</span>, <span class="st">'./backup/hydrology.hyd'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">hydrology_hyd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SWATreadR/man/read_swat.html" class="external-link">read_swat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">model_path</span>, <span class="st">'/hydrology.hyd'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hydrology_hyd</span><span class="op">$</span><span class="va">esco</span> <span class="op">&lt;-</span> <span class="fl">0.02</span> <span class="co"># set value</span></span>
<span><span class="va">hydrology_hyd</span><span class="op">$</span><span class="va">epco</span> <span class="op">&lt;-</span> <span class="fl">0.12</span> <span class="co"># set value if epco is considered</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/SWATreadR/man/write_swat.html" class="external-link">write_swat</a></span><span class="op">(</span><span class="va">hydrology_hyd</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">model_path</span>, <span class="st">'/hydrology.hyd'</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Option 2: Setting parameter values for SWATrunR runs</span></span>
<span><span class="co"># To further use esco and epco ranges in e.g. the hard calibration workflow</span></span>
<span><span class="co"># add esco and epco ranges in the parameter definition (by default they are</span></span>
<span><span class="co"># included). To include their full ranges it may look like this.</span></span>
<span><span class="co"># Please adjust the ranges based on the results above.</span></span>
<span></span>
<span><span class="va">parameter_boundaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  <span class="st">'esco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">'epco.hru | change = absval'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Svajunas Plunge, Christoph Schuerz, Michael Strauch, Mikołaj Piniewski.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
